from typing import TYPE_CHECKING, Any, Dict, List
import logging
logger = logging.getLogger(__name__)

from beaker_kernel.lib.context import BaseContext
from beaker_kernel.lib.autodiscovery import autodiscover
from beaker_kernel.lib.utils import action

from .agent import DefaultAgent

if TYPE_CHECKING:
    from beaker_kernel.kernel import LLMKernel
    from beaker_kernel.lib.agent import BaseAgent
    from beaker_kernel.lib.subkernels.base import BaseSubkernel

class DefaultContext(BaseContext):

    agent_cls: "BaseAgent" = DefaultAgent

    WEIGHT: 10

    def __init__(self, beaker_kernel: "LLMKernel", subkernel: "BaseSubkernel", config: Dict[str, Any]) -> None:
        super().__init__(beaker_kernel, subkernel, self.agent_cls, config)

    @classmethod
    def available_subkernels(cls) -> List["BaseSubkernel"]:
        subkernels: Dict[str, BaseSubkernel] = autodiscover("subkernels")
        subkernel_list = sorted(subkernels.values(), key=lambda subkernel: (subkernel.WEIGHT, subkernel.SLUG))
        subkernel_slugs = [subkernel.SLUG for subkernel in subkernel_list]
        return subkernel_slugs

    async def auto_context(self):
        return f"""
        If you need to generate code, you should write it in the '{self.subkernel.DISPLAY_NAME}' language for execution
        in a Jupyter notebook using the '{self.subkernel.KERNEL_NAME}' kernel.
        """.strip()

    async def generate_preview(self):
        """
        Preview what exists in the subkernel.
        """
        # fetch_state_code = self.subkernel.FETCH_STATE_CODE
        # result = await self.beaker_kernel.evaluate(fetch_state_code)
        # state = result.get("return", None)
        # if state:
        return { "decapodes": { "decapode": { "text/plain": "SummationDecapode{Any, Any, Symbol} {Var:27, TVar:1, Op1:8, Op2:11, \u03a3:2, Summand:4, Type:0, Operator:0, Name:0}\n\u250c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Var \u2502     type \u2502   name \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   1 \u2502    Form0 \u2502      h \u2502\n\u2502   2 \u2502    Form1 \u2502      \u0393 \u2502\n\u2502   3 \u2502 Constant \u2502      n \u2502\n\u2502   4 \u2502 Constant \u2502      A \u2502\n\u2502   5 \u2502 Constant \u2502      \u03c1 \u2502\n\u2502   6 \u2502 Constant \u2502      g \u2502\n\u2502   7 \u2502    infer \u2502      \u1e23 \u2502\n\u2502   8 \u2502    infer \u2502     \u20221 \u2502\n\u2502   9 \u2502    infer \u2502 mult_1 \u2502\n\u2502  10 \u2502    infer \u2502     \u20222 \u2502\n\u2502  11 \u2502    infer \u2502     \u20223 \u2502\n\u2502  12 \u2502    infer \u2502     \u20224 \u2502\n\u2502  13 \u2502    infer \u2502     \u20225 \u2502\n\u2502  14 \u2502    infer \u2502     \u20226 \u2502\n\u2502  15 \u2502    infer \u2502     \u20227 \u2502\n\u2502  16 \u2502    infer \u2502     \u20228 \u2502\n\u2502  17 \u2502  Literal \u2502      1 \u2502\n\u2502  18 \u2502    infer \u2502     \u20229 \u2502\n\u2502  19 \u2502    infer \u2502    \u202210 \u2502\n\u2502  20 \u2502  Literal \u2502      2 \u2502\n\u2502  21 \u2502    infer \u2502  sum_1 \u2502\n\u2502  22 \u2502    infer \u2502 mult_2 \u2502\n\u2502  23 \u2502    infer \u2502 mult_3 \u2502\n\u2502  24 \u2502    infer \u2502 mult_4 \u2502\n\u2502  25 \u2502    infer \u2502    \u202211 \u2502\n\u2502  26 \u2502    infer \u2502  sum_2 \u2502\n\u2502  27 \u2502    infer \u2502    \u202212 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 TVar \u2502 incl \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502    1 \u2502    7 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Op1 \u2502 src \u2502 tgt \u2502          op1 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   1 \u2502   1 \u2502   7 \u2502           \u2202\u209c \u2502\n\u2502   2 \u2502   1 \u2502  10 \u2502            d \u2502\n\u2502   3 \u2502   1 \u2502  15 \u2502            d \u2502\n\u2502   4 \u2502  15 \u2502  14 \u2502            \u266f \u2502\n\u2502   5 \u2502  14 \u2502  13 \u2502          mag \u2502\n\u2502   6 \u2502  12 \u2502  11 \u2502        avg\u2080\u2081 \u2502\n\u2502   7 \u2502  19 \u2502  18 \u2502        avg\u2080\u2081 \u2502\n\u2502   8 \u2502  24 \u2502   7 \u2502 [:\u22c6, :d, :\u22c6] \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Op2 \u2502 proj1 \u2502 proj2 \u2502 res \u2502 op2 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   1 \u2502     3 \u2502    17 \u2502  16 \u2502   - \u2502\n\u2502   2 \u2502    13 \u2502    16 \u2502  12 \u2502   ^ \u2502\n\u2502   3 \u2502     1 \u2502    21 \u2502  19 \u2502   ^ \u2502\n\u2502   4 \u2502     2 \u2502    10 \u2502  22 \u2502   * \u2502\n\u2502   5 \u2502    22 \u2502    11 \u2502  23 \u2502   * \u2502\n\u2502   6 \u2502    23 \u2502    18 \u2502  24 \u2502   * \u2502\n\u2502   7 \u2502    20 \u2502    26 \u2502  25 \u2502   / \u2502\n\u2502   8 \u2502     5 \u2502     6 \u2502   8 \u2502   * \u2502\n\u2502   9 \u2502     8 \u2502     3 \u2502  27 \u2502   ^ \u2502\n\u2502  10 \u2502    25 \u2502     4 \u2502   9 \u2502   * \u2502\n\u2502  11 \u2502     9 \u2502    27 \u2502   2 \u2502   * \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u03a3 \u2502 sum \u2502\n\u251c\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 1 \u2502  21 \u2502\n\u2502 2 \u2502  26 \u2502\n\u2514\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2518\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Summand \u2502 summand \u2502 summation \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502       1 \u2502       3 \u2502         1 \u2502\n\u2502       2 \u2502      20 \u2502         1 \u2502\n\u2502       3 \u2502       3 \u2502         2 \u2502\n\u2502       4 \u2502      20 \u2502         2 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n", "application/x-askem-decapode-json-graph": { "graph": { "V": [ { "_id": 1, "vprops": { "label": "h:\u03a9\u2080" } }, { "_id": 2, "vprops": { "label": "\u0393:\u03a9\u2081" } }, { "_id": 3, "vprops": { "label": "n:\u03a9C" } }, { "_id": 4, "vprops": { "label": "A:\u03a9C" } }, { "_id": 5, "vprops": { "label": "\u03c1:\u03a9C" } }, { "_id": 6, "vprops": { "label": "g:\u03a9C" } }, { "_id": 7, "vprops": { "label": "\u1e23:\u03a9\u2022" } }, { "_id": 8, "vprops": { "label": "\u20221:\u03a9\u2022" } }, { "_id": 9, "vprops": { "label": "mult_1:\u03a9\u2022" } }, { "_id": 10, "vprops": { "label": "\u20222:\u03a9\u2022" } }, { "_id": 11, "vprops": { "label": "\u20223:\u03a9\u2022" } }, { "_id": 12, "vprops": { "label": "\u20224:\u03a9\u2022" } }, { "_id": 13, "vprops": { "label": "\u20225:\u03a9\u2022" } }, { "_id": 14, "vprops": { "label": "\u20226:\u03a9\u2022" } }, { "_id": 15, "vprops": { "label": "\u20227:\u03a9\u2022" } }, { "_id": 16, "vprops": { "label": "\u20228:\u03a9\u2022" } }, { "_id": 17, "vprops": { "label": "1:\u03a9L" } }, { "_id": 18, "vprops": { "label": "\u20229:\u03a9\u2022" } }, { "_id": 19, "vprops": { "label": "\u202210:\u03a9\u2022" } }, { "_id": 20, "vprops": { "label": "2:\u03a9L" } }, { "_id": 21, "vprops": { "label": "sum_1:\u03a9\u2022" } }, { "_id": 22, "vprops": { "label": "mult_2:\u03a9\u2022" } }, { "_id": 23, "vprops": { "label": "mult_3:\u03a9\u2022" } }, { "_id": 24, "vprops": { "label": "mult_4:\u03a9\u2022" } }, { "_id": 25, "vprops": { "label": "\u202211:\u03a9\u2022" } }, { "_id": 26, "vprops": { "label": "sum_2:\u03a9\u2022" } }, { "_id": 27, "vprops": { "label": "\u202212:\u03a9\u2022" } }, { "_id": 28, "vprops": { "label": "", "shape": "none" } }, { "_id": 29, "vprops": { "label": "", "shape": "none" } }, { "_id": 30, "vprops": { "label": "\u03a9C\u00d7\u03a9L", "shape": "rectangle" } }, { "_id": 31, "vprops": { "label": "\u03a9\u2022\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 32, "vprops": { "label": "\u03a9\u2080\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 33, "vprops": { "label": "\u03a9\u2081\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 34, "vprops": { "label": "\u03a9\u2022\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 35, "vprops": { "label": "\u03a9\u2022\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 36, "vprops": { "label": "\u03a9L\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 37, "vprops": { "label": "\u03a9C\u00d7\u03a9C", "shape": "rectangle" } }, { "_id": 38, "vprops": { "label": "\u03a9\u2022\u00d7\u03a9C", "shape": "rectangle" } }, { "_id": 39, "vprops": { "label": "\u03a9\u2022\u00d7\u03a9C", "shape": "rectangle" } }, { "_id": 40, "vprops": { "label": "\u03a9\u2022\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 41, "vprops": { "label": "\u03a31", "shape": "circle" } }, { "_id": 42, "vprops": { "label": "\u03a32", "shape": "circle" } } ], "E": [ { "_id": 1, "src": 28, "tgt": 1, "eprops": {} }, { "_id": 2, "src": 28, "tgt": 3, "eprops": {} }, { "_id": 3, "src": 28, "tgt": 4, "eprops": {} }, { "_id": 4, "src": 28, "tgt": 5, "eprops": {} }, { "_id": 5, "src": 28, "tgt": 6, "eprops": {} }, { "_id": 6, "src": 7, "tgt": 29, "eprops": {} }, { "_id": 7, "src": 1, "tgt": 7, "eprops": { "label": "\u2202\u209c" } }, { "_id": 8, "src": 1, "tgt": 10, "eprops": { "label": "d" } }, { "_id": 9, "src": 1, "tgt": 15, "eprops": { "label": "d" } }, { "_id": 10, "src": 15, "tgt": 14, "eprops": { "label": "\u266f" } }, { "_id": 11, "src": 14, "tgt": 13, "eprops": { "label": "mag" } }, { "_id": 12, "src": 12, "tgt": 11, "eprops": { "label": "avg\u2080\u2081" } }, { "_id": 13, "src": 19, "tgt": 18, "eprops": { "label": "avg\u2080\u2081" } }, { "_id": 14, "src": 24, "tgt": 7, "eprops": { "label": "\u22c6\u22c5d\u22c5\u22c6" } }, { "_id": 15, "src": 3, "tgt": 30, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 16, "src": 17, "tgt": 30, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 17, "src": 30, "tgt": 16, "eprops": { "label": "-" } }, { "_id": 18, "src": 13, "tgt": 31, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 19, "src": 16, "tgt": 31, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 20, "src": 31, "tgt": 12, "eprops": { "label": "^" } }, { "_id": 21, "src": 1, "tgt": 32, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 22, "src": 21, "tgt": 32, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 23, "src": 32, "tgt": 19, "eprops": { "label": "^" } }, { "_id": 24, "src": 2, "tgt": 33, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 25, "src": 10, "tgt": 33, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 26, "src": 33, "tgt": 22, "eprops": { "label": "*" } }, { "_id": 27, "src": 22, "tgt": 34, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 28, "src": 11, "tgt": 34, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 29, "src": 34, "tgt": 23, "eprops": { "label": "*" } }, { "_id": 30, "src": 23, "tgt": 35, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 31, "src": 18, "tgt": 35, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 32, "src": 35, "tgt": 24, "eprops": { "label": "*" } }, { "_id": 33, "src": 20, "tgt": 36, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 34, "src": 26, "tgt": 36, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 35, "src": 36, "tgt": 25, "eprops": { "label": "/" } }, { "_id": 36, "src": 5, "tgt": 37, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 37, "src": 6, "tgt": 37, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 38, "src": 37, "tgt": 8, "eprops": { "label": "*" } }, { "_id": 39, "src": 8, "tgt": 38, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 40, "src": 3, "tgt": 38, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 41, "src": 38, "tgt": 27, "eprops": { "label": "^" } }, { "_id": 42, "src": 25, "tgt": 39, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 43, "src": 4, "tgt": 39, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 44, "src": 39, "tgt": 9, "eprops": { "label": "*" } }, { "_id": 45, "src": 9, "tgt": 40, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 46, "src": 27, "tgt": 40, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 47, "src": 40, "tgt": 2, "eprops": { "label": "*" } }, { "_id": 48, "src": 41, "tgt": 21, "eprops": { "label": "+" } }, { "_id": 49, "src": 42, "tgt": 26, "eprops": { "label": "+" } }, { "_id": 50, "src": 3, "tgt": 41, "eprops": { "style": "dashed" } }, { "_id": 51, "src": 20, "tgt": 41, "eprops": { "style": "dashed" } }, { "_id": 52, "src": 3, "tgt": 42, "eprops": { "style": "dashed" } }, { "_id": 53, "src": 20, "tgt": 42, "eprops": { "style": "dashed" } } ], "Props": [] }, "gprops": { "graph": { "rankdir": "TB" }, "edge": { "arrowsize": "0.5" }, "node": { "width": "0.05", "height": "0.05", "margin": "0", "shape": "oval" }, "prog": "dot" } }, "text/html": "<div class=\"c-set\">\n<span class=\"c-set-summary\">SummationDecapode{Any, Any, Symbol} {Var:27, TVar:1, Op1:8, Op2:11, \u03a3:2, Summand:4, Type:0, Operator:0, Name:0}</span>\n<table>\n  <thead>\n    <tr class = \"header headerLastRow\">\n      <th class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">Var</th>\n      <th style = \"text-align: right;\">type</th>\n      <th style = \"text-align: right;\">name</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">1</td>\n      <td style = \"text-align: right;\">Form0</td>\n      <td style = \"text-align: right;\">h</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">2</td>\n      <td style = \"text-align: right;\">Form1</td>\n      <td style = \"text-align: right;\">\u0393</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">3</td>\n      <td style = \"text-align: right;\">Constant</td>\n      <td style = \"text-align: right;\">n</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">4</td>\n      <td style = \"text-align: right;\">Constant</td>\n      <td style = \"text-align: right;\">A</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">5</td>\n      <td style = \"text-align: right;\">Constant</td>\n      <td style = \"text-align: right;\">\u03c1</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">6</td>\n      <td style = \"text-align: right;\">Constant</td>\n      <td style = \"text-align: right;\">g</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">7</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u1e23</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">8</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u20221</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">9</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">mult_1</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">10</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u20222</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">11</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u20223</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">12</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u20224</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">13</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u20225</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">14</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u20226</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">15</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u20227</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">16</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u20228</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">17</td>\n      <td style = \"text-align: right;\">Literal</td>\n      <td style = \"text-align: right;\">1</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">18</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u20229</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">19</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u202210</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">20</td>\n      <td style = \"text-align: right;\">Literal</td>\n      <td style = \"text-align: right;\">2</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">21</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">sum_1</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">22</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">mult_2</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">23</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">mult_3</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">24</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">mult_4</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">25</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u202211</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">26</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">sum_2</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">27</td>\n      <td style = \"text-align: right;\">infer</td>\n      <td style = \"text-align: right;\">\u202212</td>\n    </tr>\n  </tbody>\n</table>\n<table>\n  <thead>\n    <tr class = \"header headerLastRow\">\n      <th class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">TVar</th>\n      <th style = \"text-align: right;\">incl</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">1</td>\n      <td style = \"text-align: right;\">7</td>\n    </tr>\n  </tbody>\n</table>\n<table>\n  <thead>\n    <tr class = \"header headerLastRow\">\n      <th class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">Op1</th>\n      <th style = \"text-align: right;\">src</th>\n      <th style = \"text-align: right;\">tgt</th>\n      <th style = \"text-align: right;\">op1</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">1</td>\n      <td style = \"text-align: right;\">1</td>\n      <td style = \"text-align: right;\">7</td>\n      <td style = \"text-align: right;\">\u2202\u209c</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">2</td>\n      <td style = \"text-align: right;\">1</td>\n      <td style = \"text-align: right;\">10</td>\n      <td style = \"text-align: right;\">d</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">3</td>\n      <td style = \"text-align: right;\">1</td>\n      <td style = \"text-align: right;\">15</td>\n      <td style = \"text-align: right;\">d</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">4</td>\n      <td style = \"text-align: right;\">15</td>\n      <td style = \"text-align: right;\">14</td>\n      <td style = \"text-align: right;\">\u266f</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">5</td>\n      <td style = \"text-align: right;\">14</td>\n      <td style = \"text-align: right;\">13</td>\n      <td style = \"text-align: right;\">mag</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">6</td>\n      <td style = \"text-align: right;\">12</td>\n      <td style = \"text-align: right;\">11</td>\n      <td style = \"text-align: right;\">avg\u2080\u2081</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">7</td>\n      <td style = \"text-align: right;\">19</td>\n      <td style = \"text-align: right;\">18</td>\n      <td style = \"text-align: right;\">avg\u2080\u2081</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">8</td>\n      <td style = \"text-align: right;\">24</td>\n      <td style = \"text-align: right;\">7</td>\n      <td style = \"text-align: right;\">[:\u22c6, :d, :\u22c6]</td>\n    </tr>\n  </tbody>\n</table>\n<table>\n  <thead>\n    <tr class = \"header headerLastRow\">\n      <th class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">Op2</th>\n      <th style = \"text-align: right;\">proj1</th>\n      <th style = \"text-align: right;\">proj2</th>\n      <th style = \"text-align: right;\">res</th>\n      <th style = \"text-align: right;\">op2</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">1</td>\n      <td style = \"text-align: right;\">3</td>\n      <td style = \"text-align: right;\">17</td>\n      <td style = \"text-align: right;\">16</td>\n      <td style = \"text-align: right;\">-</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">2</td>\n      <td style = \"text-align: right;\">13</td>\n      <td style = \"text-align: right;\">16</td>\n      <td style = \"text-align: right;\">12</td>\n      <td style = \"text-align: right;\">^</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">3</td>\n      <td style = \"text-align: right;\">1</td>\n      <td style = \"text-align: right;\">21</td>\n      <td style = \"text-align: right;\">19</td>\n      <td style = \"text-align: right;\">^</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">4</td>\n      <td style = \"text-align: right;\">2</td>\n      <td style = \"text-align: right;\">10</td>\n      <td style = \"text-align: right;\">22</td>\n      <td style = \"text-align: right;\">*</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">5</td>\n      <td style = \"text-align: right;\">22</td>\n      <td style = \"text-align: right;\">11</td>\n      <td style = \"text-align: right;\">23</td>\n      <td style = \"text-align: right;\">*</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">6</td>\n      <td style = \"text-align: right;\">23</td>\n      <td style = \"text-align: right;\">18</td>\n      <td style = \"text-align: right;\">24</td>\n      <td style = \"text-align: right;\">*</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">7</td>\n      <td style = \"text-align: right;\">20</td>\n      <td style = \"text-align: right;\">26</td>\n      <td style = \"text-align: right;\">25</td>\n      <td style = \"text-align: right;\">/</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">8</td>\n      <td style = \"text-align: right;\">5</td>\n      <td style = \"text-align: right;\">6</td>\n      <td style = \"text-align: right;\">8</td>\n      <td style = \"text-align: right;\">*</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">9</td>\n      <td style = \"text-align: right;\">8</td>\n      <td style = \"text-align: right;\">3</td>\n      <td style = \"text-align: right;\">27</td>\n      <td style = \"text-align: right;\">^</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">10</td>\n      <td style = \"text-align: right;\">25</td>\n      <td style = \"text-align: right;\">4</td>\n      <td style = \"text-align: right;\">9</td>\n      <td style = \"text-align: right;\">*</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">11</td>\n      <td style = \"text-align: right;\">9</td>\n      <td style = \"text-align: right;\">27</td>\n      <td style = \"text-align: right;\">2</td>\n      <td style = \"text-align: right;\">*</td>\n    </tr>\n  </tbody>\n</table>\n<table>\n  <thead>\n    <tr class = \"header headerLastRow\">\n      <th class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">\u03a3</th>\n      <th style = \"text-align: right;\">sum</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">1</td>\n      <td style = \"text-align: right;\">21</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">2</td>\n      <td style = \"text-align: right;\">26</td>\n    </tr>\n  </tbody>\n</table>\n<table>\n  <thead>\n    <tr class = \"header headerLastRow\">\n      <th class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">Summand</th>\n      <th style = \"text-align: right;\">summand</th>\n      <th style = \"text-align: right;\">summation</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">1</td>\n      <td style = \"text-align: right;\">3</td>\n      <td style = \"text-align: right;\">1</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">2</td>\n      <td style = \"text-align: right;\">20</td>\n      <td style = \"text-align: right;\">1</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">3</td>\n      <td style = \"text-align: right;\">3</td>\n      <td style = \"text-align: right;\">2</td>\n    </tr>\n    <tr>\n      <td class = \"rowLabel\" style = \"font-weight: bold; text-align: right;\">4</td>\n      <td style = \"text-align: right;\">20</td>\n      <td style = \"text-align: right;\">2</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n", "application/json": { "graph": { "V": [ { "_id": 1, "vprops": { "label": "h:\u03a9\u2080" } }, { "_id": 2, "vprops": { "label": "\u0393:\u03a9\u2081" } }, { "_id": 3, "vprops": { "label": "n:\u03a9C" } }, { "_id": 4, "vprops": { "label": "A:\u03a9C" } }, { "_id": 5, "vprops": { "label": "\u03c1:\u03a9C" } }, { "_id": 6, "vprops": { "label": "g:\u03a9C" } }, { "_id": 7, "vprops": { "label": "\u1e23:\u03a9\u2022" } }, { "_id": 8, "vprops": { "label": "\u20221:\u03a9\u2022" } }, { "_id": 9, "vprops": { "label": "mult_1:\u03a9\u2022" } }, { "_id": 10, "vprops": { "label": "\u20222:\u03a9\u2022" } }, { "_id": 11, "vprops": { "label": "\u20223:\u03a9\u2022" } }, { "_id": 12, "vprops": { "label": "\u20224:\u03a9\u2022" } }, { "_id": 13, "vprops": { "label": "\u20225:\u03a9\u2022" } }, { "_id": 14, "vprops": { "label": "\u20226:\u03a9\u2022" } }, { "_id": 15, "vprops": { "label": "\u20227:\u03a9\u2022" } }, { "_id": 16, "vprops": { "label": "\u20228:\u03a9\u2022" } }, { "_id": 17, "vprops": { "label": "1:\u03a9L" } }, { "_id": 18, "vprops": { "label": "\u20229:\u03a9\u2022" } }, { "_id": 19, "vprops": { "label": "\u202210:\u03a9\u2022" } }, { "_id": 20, "vprops": { "label": "2:\u03a9L" } }, { "_id": 21, "vprops": { "label": "sum_1:\u03a9\u2022" } }, { "_id": 22, "vprops": { "label": "mult_2:\u03a9\u2022" } }, { "_id": 23, "vprops": { "label": "mult_3:\u03a9\u2022" } }, { "_id": 24, "vprops": { "label": "mult_4:\u03a9\u2022" } }, { "_id": 25, "vprops": { "label": "\u202211:\u03a9\u2022" } }, { "_id": 26, "vprops": { "label": "sum_2:\u03a9\u2022" } }, { "_id": 27, "vprops": { "label": "\u202212:\u03a9\u2022" } }, { "_id": 28, "vprops": { "label": "", "shape": "none" } }, { "_id": 29, "vprops": { "label": "", "shape": "none" } }, { "_id": 30, "vprops": { "label": "\u03a9C\u00d7\u03a9L", "shape": "rectangle" } }, { "_id": 31, "vprops": { "label": "\u03a9\u2022\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 32, "vprops": { "label": "\u03a9\u2080\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 33, "vprops": { "label": "\u03a9\u2081\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 34, "vprops": { "label": "\u03a9\u2022\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 35, "vprops": { "label": "\u03a9\u2022\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 36, "vprops": { "label": "\u03a9L\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 37, "vprops": { "label": "\u03a9C\u00d7\u03a9C", "shape": "rectangle" } }, { "_id": 38, "vprops": { "label": "\u03a9\u2022\u00d7\u03a9C", "shape": "rectangle" } }, { "_id": 39, "vprops": { "label": "\u03a9\u2022\u00d7\u03a9C", "shape": "rectangle" } }, { "_id": 40, "vprops": { "label": "\u03a9\u2022\u00d7\u03a9\u2022", "shape": "rectangle" } }, { "_id": 41, "vprops": { "label": "\u03a31", "shape": "circle" } }, { "_id": 42, "vprops": { "label": "\u03a32", "shape": "circle" } } ], "E": [ { "_id": 1, "src": 28, "tgt": 1, "eprops": {} }, { "_id": 2, "src": 28, "tgt": 3, "eprops": {} }, { "_id": 3, "src": 28, "tgt": 4, "eprops": {} }, { "_id": 4, "src": 28, "tgt": 5, "eprops": {} }, { "_id": 5, "src": 28, "tgt": 6, "eprops": {} }, { "_id": 6, "src": 7, "tgt": 29, "eprops": {} }, { "_id": 7, "src": 1, "tgt": 7, "eprops": { "label": "\u2202\u209c" } }, { "_id": 8, "src": 1, "tgt": 10, "eprops": { "label": "d" } }, { "_id": 9, "src": 1, "tgt": 15, "eprops": { "label": "d" } }, { "_id": 10, "src": 15, "tgt": 14, "eprops": { "label": "\u266f" } }, { "_id": 11, "src": 14, "tgt": 13, "eprops": { "label": "mag" } }, { "_id": 12, "src": 12, "tgt": 11, "eprops": { "label": "avg\u2080\u2081" } }, { "_id": 13, "src": 19, "tgt": 18, "eprops": { "label": "avg\u2080\u2081" } }, { "_id": 14, "src": 24, "tgt": 7, "eprops": { "label": "\u22c6\u22c5d\u22c5\u22c6" } }, { "_id": 15, "src": 3, "tgt": 30, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 16, "src": 17, "tgt": 30, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 17, "src": 30, "tgt": 16, "eprops": { "label": "-" } }, { "_id": 18, "src": 13, "tgt": 31, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 19, "src": 16, "tgt": 31, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 20, "src": 31, "tgt": 12, "eprops": { "label": "^" } }, { "_id": 21, "src": 1, "tgt": 32, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 22, "src": 21, "tgt": 32, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 23, "src": 32, "tgt": 19, "eprops": { "label": "^" } }, { "_id": 24, "src": 2, "tgt": 33, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 25, "src": 10, "tgt": 33, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 26, "src": 33, "tgt": 22, "eprops": { "label": "*" } }, { "_id": 27, "src": 22, "tgt": 34, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 28, "src": 11, "tgt": 34, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 29, "src": 34, "tgt": 23, "eprops": { "label": "*" } }, { "_id": 30, "src": 23, "tgt": 35, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 31, "src": 18, "tgt": 35, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 32, "src": 35, "tgt": 24, "eprops": { "label": "*" } }, { "_id": 33, "src": 20, "tgt": 36, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 34, "src": 26, "tgt": 36, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 35, "src": 36, "tgt": 25, "eprops": { "label": "/" } }, { "_id": 36, "src": 5, "tgt": 37, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 37, "src": 6, "tgt": 37, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 38, "src": 37, "tgt": 8, "eprops": { "label": "*" } }, { "_id": 39, "src": 8, "tgt": 38, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 40, "src": 3, "tgt": 38, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 41, "src": 38, "tgt": 27, "eprops": { "label": "^" } }, { "_id": 42, "src": 25, "tgt": 39, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 43, "src": 4, "tgt": 39, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 44, "src": 39, "tgt": 9, "eprops": { "label": "*" } }, { "_id": 45, "src": 9, "tgt": 40, "eprops": { "label": "\u03c0\u2081", "style": "dashed" } }, { "_id": 46, "src": 27, "tgt": 40, "eprops": { "label": "\u03c0\u2082", "style": "dashed" } }, { "_id": 47, "src": 40, "tgt": 2, "eprops": { "label": "*" } }, { "_id": 48, "src": 41, "tgt": 21, "eprops": { "label": "+" } }, { "_id": 49, "src": 42, "tgt": 26, "eprops": { "label": "+" } }, { "_id": 50, "src": 3, "tgt": 41, "eprops": { "style": "dashed" } }, { "_id": 51, "src": 20, "tgt": 41, "eprops": { "style": "dashed" } }, { "_id": 52, "src": 3, "tgt": 42, "eprops": { "style": "dashed" } }, { "_id": 53, "src": 20, "tgt": 42, "eprops": { "style": "dashed" } } ], "Props": [] }, "gprops": { "graph": { "rankdir": "TB" }, "edge": { "arrowsize": "0.5" }, "node": { "width": "0.05", "height": "0.05", "margin": "0", "shape": "oval" }, "prog": "dot" } } } } }
